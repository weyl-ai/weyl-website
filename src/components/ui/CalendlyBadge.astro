---
// src/components/ui/CalendlyBadge.astro
// Calendly badge widget component with custom theming
---

<!-- Calendly badge widget -->
<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
<script is:inline src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>

<script is:inline>
  // Initialize Calendly badge after DOM is ready
  function initCalendly() {
    if (window.Calendly) {
      // Get the current theme color from CSS variables
      const primaryColor = getComputedStyle(document.documentElement)
        .getPropertyValue('--color-brand-primary').trim();
      const textColor = getComputedStyle(document.documentElement)
        .getPropertyValue('--color-text-primary').trim();
      
      // Initialize with theme-aware colors
      window.Calendly.initBadgeWidget({
        url: 'https://calendly.com/harrison-weyl/30min',
        text: 'Schedule a Call',
        color: primaryColor || '#54aeff',
        textColor: textColor || '#e6f7ff',
        branding: false
      });
    }
  }

  // Try to init when the script loads
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCalendly);
  } else {
    initCalendly();
  }

  // Re-initialize when theme changes to update colors
  if (typeof window !== 'undefined') {
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.attributeName === 'data-theme') {
          // Remove old badge
          const oldBadge = document.querySelector('.calendly-badge-widget');
          if (oldBadge) {
            oldBadge.remove();
          }
          // Reinitialize with new theme colors
          setTimeout(initCalendly, 100);
        }
      });
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-theme']
    });
  }
</script>

<style is:global>
  /* Override default Calendly styles to match brand Button component */
  .calendly-badge-widget {
    font-family: var(--font-mono) !important;
    font-weight: 600 !important;
    letter-spacing: var(--tracking-normal) !important;
    border-radius: var(--radius-md) !important;
    transition: all 0.2s ease !important;
    right: 20px !important;
    bottom: 20px !important;
    padding: 0 !important;
    /* Match primary button styling */
    background: var(--color-brand-primary) !important;
    box-shadow: var(--glow-sm) !important;
  }

  .calendly-badge-widget:hover {
    filter: brightness(1.1) !important;
    box-shadow: var(--glow-md) !important;
    transform: translateY(-2px) !important;
  }

  .calendly-badge-widget .calendly-badge-content {
    font-weight: 600 !important;
    font-size: var(--text-small) !important;
    /* Match md button padding */
    padding: 12px 24px !important;
    border-radius: var(--radius-md) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    background: transparent !important;
  }

  /* Text color matches button */
  .calendly-badge-widget .calendly-badge-content,
  .calendly-badge-widget .calendly-badge-content span {
    color: var(--color-bg-primary) !important;
    border-radius: var(--radius-md) !important;
  }

  /* Light mode adjustments */
  [data-theme="light"] .calendly-badge-widget {
    background: var(--color-brand-primary) !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  }

  [data-theme="light"] .calendly-badge-widget:hover {
    filter: brightness(0.9) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
  }
  
  [data-theme="light"] .calendly-badge-widget .calendly-badge-content,
  [data-theme="light"] .calendly-badge-widget .calendly-badge-content span {
    color: #ffffff !important;
  }
</style>

